{% extends 'fhir/doctor.html' %}
{%block leftbody%}
    <ul>
        <li><a href={%block url1%}{%endblock%}> Thông tin hành chính </a></li>
        <li><a href={%block url2%}{%endblock%}> Thông tin đăng ký khám </a></li>
        <li><a href={%block url3%}{%endblock%}> Thông tin hỏi bệnh </a></li>
        {%block leftbar%}
        {%endblock%}
    
        <!-- <button id="myButton" class="float-left submit-button" >Add a service</button>
        <script type="text/javascript">
            document.getElementById("myButton").onclick = function () {
                location.href = " ";
            };
        </script> -->
    </ul>
{%endblock%}
{%block function %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/fhir/display.css'%}">
<style>
    .servicePopup {
        position: relative;
        text-align: center;
        width: 100%;
    }

    .formPopup {
        display: none;
        transform: translate(-50%, 5%);
        border: 3px solid #999999;
        z-index: 9;
        text-align: center;
        width: 60%;
        height: 50%;

    }

    .formContainer {
        max-width: 100%;
        padding: 20px;
        background-color: #fff;
        text-align: left;
        max-height: 100%;
        height: 100%;
    }

    .formContainer .btn {
        padding: 12px 20px;
        border: none;
        background-color: #8ebf42;
        color: #fff;
        cursor: pointer;
        width: 100%;
        margin-bottom: 15px;
        opacity: 0.8;
    }

    .formContainer .cancel {
        background-color: #cc0000;
    }

    .formContainer .btn:hover,
    .openButton:hover {
        opacity: 1;
    }
</style>
<div class="display-box">
    <div class="display-data">
        <h1>Thông tin bệnh nhân</h1>
        <div class="patient-data">
            <div class="text-data">
                <div class="name patient">
                    <h4 class="title">Họ và tên:</h4>
                    <h4 class="value">{{data.Patient.name}}</h4>
                </div>
                <div class="identifier patient">
                    <h4 class="title">Giới tính:</h4>
                    <h4 class="value">{{data.Patient.gender}}</h4>
                </div>
                <div class="gender patient">
                    <h4 class="title">Mã y tế:</h4>
                    <h4 class="value">{{data.Patient.identifier}}</h4>
                </div>
                <div class="birth patient">
                    <h4 class="title">Địa chỉ:</h4>
                    <h4 class="value">{{data.Patient.home_address}}</h4>
                </div>
                <div class="work patient">
                    <h4 class="title">Nơi làm việc:</h4>
                    <h4 class="value">{{data.Patient.work_address}}</h4>
                </div>
                <div class="home patient">
                    <h4 class="title">Số điện thoại:</h4>
                    <h4 class="value">{{data.Patient.telecom}}</h4>
                </div>
            </div>
            <div class="patient-image">
                <img src="{% static 'img/patient/' %}{{data.Patient.identifier}}.jpg" alt="">
            </div>
        </div>
        <div class="encounter-data">
        </div>
        <h1>CÁC LẦN ĐĂNG KÝ KHÁM </h1>
        <table>
            <tr>
                <td>Ngày đăng ký</td>
                <td>Mã đợt khám</td>
                <td>Loại thăm khám</td>
                <td>Tình trạng thăm khám</td>
                <td>Ngày kết thúc</td>
            </tr>
            {%if data.Encounter%}
            {%if data.encounter_type == 'list'%}
            {%for encounter in data.Encounter%}
            <tr>
                <td>{{encounter.encounter_start}}</td>
                <td><a
                        href="{% url 'fhir:hanhchinh' group_name user_name data.Patient.identifier encounter.encounter_identifier %}">{{encounter.encounter_identifier}}</a>
                </td>
                <td>{{class|get_value:encounter.encounter_class}}</td>
                {% if encounter.encounter_status == 'in-progress' %}
                <td> Đang Khám</td>
                {%elif encounter.encounter_status == 'finished'%}
                <td>Đã Khám xong</td>
                {%endif%}
                {%if encounter.encounter_end%}
                <td>{{encounter.encounter_end}}</td>
                {%endif%}
            </tr>
            {%endfor%}

            {%elif data.encounter_type == 'dict'%}
            <tr>
                <td>{{encounter.period.start}}</td>
                <td><a
                        href="{% url 'fhir:hanhchinh' group_name user_name data.Patient.identifier data.encounter.identifier %}">{{encounter.identifier}}</a>
                </td>
                <td>{{encounter.class}}</td>
                <td>{{encounter.status}}</td>
                <td>{{encounter.period.end}}</td>
            </tr>
            {%endif%}
            {%endif%}
            <tr>
                <td colspan="5"><button class="float-left submit-button" onclick="openForm()">Lần đăng ký khám
                        mới</button></td>
            </tr>
        </table>
    </div>
    <div class="formPopup" id="popupForm">
        <form action="{% url 'fhir:encounter' group_name user_name data.Patient.identifier%}" class="formContainer"
            method="POST">
            {%csrf_token%}
            {{form.as_p}}
            <button type="submit" class="btn">Add</button>
            <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
        </form>
    </div>

</div>

<script type="text/javascript">
    document.getElementById("myButton").onclick = function () {
        location.href = "{% url 'fhir:encounter' group_name user_name data.Patient.identifier%} ";
    };
</script>
</script>
</div>
<div>
    <script>
        function openForm() {
            document.getElementById("popupForm").style.display = "inline-block";
        }
        function closeForm() {
            document.getElementById("popupForm").style.display = "none";
        }
    </script>
</div>
{%endblock%}