{%extends 'fhir/base.html'%}
{%block url1%}'{%url 'fhir:hanhchinh' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}
{%block url2%}'{%url 'fhir:dangky' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}
{%block url3%}'{%url 'fhir:hoibenh' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}
{%block url5%}'{%url 'fhir:xetnghiem' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}
{%block url4%}'{%url 'fhir:toanthan' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}
{%comment%}{%block url8%}'{%url 'fhir:thuthuat' group_name user_name data.Patient.identifier data.Encounter.identifier%}'{%endblock%}{%endcomment%}{%block url7%}'{%url 'fhir:thuoc' group_name user_name data.Patient.identifier data.Encounter.identifier %}'{%endblock%}
{%block url6%}'{%url 'fhir:hinhanh' group_name user_name data.Patient.identifier data.Encounter.identifier %}'{%endblock%}
{% load widget_tweaks %}
{%block function%}
{% comment %}
    {%if condition%}
    <div id='data'>
        <h1>THÔNG TIN HỎI BỆNH</h1>
        <p>Vấn đề lâm sàng: {{condition.condition_code}}</p>
        <p>Tình trạng: {{clinical|get_item:condition.condition_clinical_status}}</p>
        <p>Dấu hiệu bắt đầu từ ngày: {{condition.condition_onset|date:"d-m-Y"}}</p>
        <p>Mức độ: {{severity|get_item:condition.condition_severity}}</p>
    </div>
    <div id='form' style="display: none;">
        <form action="" method="POST">
            {%csrf_token%}
            <input type="hidden" name="condition_identifier" value="{{condition.condition_identifier}}">

            {%with 'value:'|add:condition.condition_code as code%}
            <label for="id_condition_code">Vấn đề lâm sàng:</label>
            <p>{{form.condition_code|attr:code}}</p>
            {%endwith%}

            {%with 'value:'|add:condition.condition_clinical_status as code%}
            <label for="id_condition_clinicalstatus">Tình trạng:</label>
            <p>{{form.condition_clinical_status|attr:code}}</p>
            {%endwith%}

            {%with condition.condition_onset|date:'Y-m-d' as condition_date%}
            {%with 'value:'|add:condition_date as code%}
            <label for="id_condition_onset">Dấu hiệu bắt đầu từ ngày:</label>
            <p>{{form.condition_onset|attr:code}}</p>
            {%endwith%}
            {%endwith%}

            {%with 'value:'|add:condition.condition_severity as code%}
            <label for="id_condition_severity">Mức độ:</label>
            <p>{{form.condition_severity|attr:code}}</p>
            {%endwith%}
            
            <button type="submit">Lưu lại</button>
        </form>
    </div>
    <div class="button">
        <button id="clickButton" onclick="changeDisplay()">Chỉnh sửa</button>
    </div>
    <script>
        function changeDisplay(){
            button = document.getElementById('clickButton');
            data = document.getElementById('data');
            form = document.getElementById('form');
            if (button.textContent == "Chỉnh sửa"){
                data.style.display = "none";
                form.style.display = "block";
                button.textContent = "Hủy bỏ"
            }
            else{
                data.style.display = "block";
                form.style.display = "none";
                button.textContent = "Chỉnh sửa"
            }
        }
    </script>
    {%else%}
        <form action="" method = "POST">
            {%csrf_token%}
            {{form.as_p}}
            <button type="submit">Lưu lại</button>
        </form>
    {%endif%}
{% endcomment %}
{% if admission_conditions %}
<div>
    <div>
        <div>
            <h2>1. Quá trình bệnh lý</h2>
            {% for condition in admission_conditions %}
                <p>{{condition.condition_code}}; {{condition.condition_clinicalstatus}}; {{condition.condition_onset|date:'d-m-Y'}}; {{condition.condition_severity}}</p>
            {% endfor %}
        </div>
        <div>
            <h2>2. Tiền sử bệnh</h2>
            <div>
                <h3>+ Bản thân</h3>
                {% for condition in resolved_conditions %}
                    <p>{{condition.condition_code}}; {{condition.condition_onset}}; {{condition.condition_abatement}}; {{condition.condition_severity}}</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% else %}
<div>
    <form action="" method="POST"> 
        {% csrf_token %}
        <div>
            <h2>1. Quá trình bệnh lý</h2>
            <textarea type="text" name="benhly" id="" required></textarea>
        </div>
        <div>
            <h2>2. Tiền sử bệnh</h2>
            <h3>+ Bản thân</h3>
            <textarea type="text" name="tiensubanthan" id=""></textarea>
            <h3>+ Dị ứng</h3>
            <!-- <div>
                <select name="allergy_stat" id="allergy_stat">
                    <option value="">-----</option>
                    <option value="active">Đang hoạt động</option>
                    <option value="inactive">Không hoạt động</option>
                    <option value="resolved">Đã khỏi</option>
                </select>
                <select name="allergy_category" id="allergy_category">
                    <option value="">-----</option>
                    <option value="food">Thức ăn</option>
                    <option value="medication">Thuốc</option>
                    <option value="environment">Môi trường</option>
                    <option value="biologic">Sinh vật</option>
                </select>
                <input type="text" name="allergy_code" id="allergy_code" placeholder="Dị ứng">
                <select name="allergy_critical" id="allergy_critical">
                    <option value="">-----</option>
                    <option value="low">Mức độ thấp</option>
                    <option value="high">Mức độ cao</option>
                    <option value="unable-to-assess">Không đánh giá được</option>
                </select>
                <input type="date" name="allergy_onset" id="allergy_onset">
                <input type="date" name="allergy_last_occurrence" id="allergy_lastoccurrence">
                <input type="text" name="allergy_reaction_substance" id="allergy_reaction_substance" placeholder="Thành phần dị ứng">
                <input type="text" name="allergy_reaction_manifestation" id="allergy_reaction_manifestation" placeholder="Phản ứng">
                <select name="allergy_reaction_severity" id="allergy_reaction_severity">
                    <option value="">-----</option>
                    <option value="mild">Nhẹ</option>
                    <option value="moderate">Vừa phải</option>
                    <option value="severe">Nặng</option>
                </select>
                <input type="text" name="allergy_reaction_note" id="allergy_reaction_note" placeholder="Ghi chú thêm cho phản ứng">
            </div> -->
            <textarea type="text" name="diung" id=""></textarea>
            <h3>+ Gia đình</h3>
            <textarea type="text" name="tiensugiadinh" id=""></textarea>
        </div>
        <button type="submit">Lưu lại</button>
    </form>
</div>
{% endif %}
{%endblock%}